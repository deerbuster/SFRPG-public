<?xml version="1.0" encoding="iso-8859-1"?>

<!-- 
  Please see the license.html file included with this distribution for 
  attribution and copyright information.
-->

<root>
	<template name="button_charselect_starships">
		<buttoncontrol>
			<anchored to="help_charselect" height="24" width="24">
				<top />
				<right anchor="left" relation="relative" offset="-5" />
			</anchored>
			<icon normal="button_starship" pressed="button_starship_down" hover="button_starship_hover" />
			<tooltip textres="button_starship" />
			<script>
				function onButtonPress()
					local w = Interface.openWindow("masterindex", "charstarshipsheet");
					w.setSize(600,700);
					
				end
			</script>
		</buttoncontrol>
	</template>

	<template name="button_archetypes">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="class_button_archetypes" />
			<script>
				function onButtonPress()
					local w = Interface.findWindow("reference_groupedlist", "reference.archetype");
					if w then					
						Interface.toggleWindow("reference_groupedlist", "reference.archetype");
					else
						w = Inrface.openWindow("reference_groupedlist", "reference.archetype");						
						w.init({ sRecordType = "archetype", sListView = "archetype" });
					end
				end
			</script>
		</button_text_sm>
	</template>

	<template name="button_feature_abilities">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="class_button_feature_abilities" />
			<script>
				function onButtonPress()
					local w = Interface.findWindow("reference_groupedlist", "reference.classfeatureability");
					if w then					
						Interface.toggleWindow("reference_groupedlist", "reference.classfeatureability");
					else
						w = Interface.openWindow("reference_groupedlist", "reference.classfeatureability");						
						w.init({ sRecordType = "classfeatureability", sListView = "byclass" });
					end
				end
			</script>
		</button_text_sm>
	</template>

	<template name="button_special_abilities">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="class_button_special_abilities" />
			<script>
				function onButtonPress()
					local w = Interface.findWindow("reference_groupedlist", "reference.classspecialability");
					if w then					
						Interface.toggleWindow("reference_groupedlist", "reference.classspecialability");
					else
						w = Interface.openWindow("reference_groupedlist", "reference.classspecialability");						
						w.init({ sRecordType = "classspecialability", sListView = "byclass" });
					end
				end
			</script>
		</button_text_sm>
	</template>
	
	<template name="button_update_class">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="class_button_update_class" />				
			<script>
				function onButtonPress()					
					local nodeRoot = DB.getRoot();
					local aClasses = DB.getChildrenGlobal(nodeRoot, "reference.class");						
					local sCallSource = "button";						
					local bButton = false;					
					ClassManager.upDateAllClasses(aClasses, sCallSource);					
				end				
			</script>
		</button_text_sm>
	</template>

	<template name="button_item_templates">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="item_button_templates" />
			<script>
				function onButtonPress()
					local w = Interface.openWindow("masterindex", "itemtemplate");					
				end
			</script>
		</button_text_sm>
	</template>

	<template name="button_item_armor">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="item_button_armor" />
			<script>
				function onButtonPress()
					local w = Interface.findWindow("reference_groupedlist", "reference.armor");
					if w then
						Interface.toggleWindow("reference_groupedlist", "reference.armor");
					else
						w = Interface.openWindow("reference_groupedlist", "reference.armor");
						w.init({ sRecordType = "item", sListView = "armor" });
					end
				end
			</script>
		</button_text_sm>
	</template>

	<template name="button_item_weapons">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="item_button_weapons" />
			<script>
				function onButtonPress()
					local w = Interface.findWindow("reference_groupedlist", "reference.weapon");
					if w then
						Interface.toggleWindow("reference_groupedlist", "reference.weapon");
					else
						w = Interface.openWindow("reference_groupedlist", "reference.weapon");
						w.init({ sRecordType = "item", sListView = "weapon" });
					end
				end
			</script>
		</button_text_sm>
	</template>

	<template name="button_npc_letter">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="npc_button_letter" />
			<script>
				function onButtonPress()
				
					local w = Interface.findWindow("reference_groupedlist", "reference.npc");
					if w then
						Interface.toggleWindow("reference_groupedlist", "reference.npc");
					else
						w = Interface.openWindow("reference_groupedlist", "reference.npc");
						w.init({ sRecordType = "npc", sListView = "byletter" });
					end
				end
			</script>
		</button_text_sm>
	</template>

	<template name="button_npc_cr">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="npc_button_cr" />
			<script>
				function onButtonPress()
					local w = Interface.findWindow("reference_groupedlist", "reference.npc");
					if w then
						Interface.toggleWindow("reference_groupedlist", "reference.npc");
					else
						w = Interface.openWindow("reference_groupedlist", "reference.npc");
						w.init({ sRecordType = "npc", sListView = "bycr" });
					end
				end
			</script>
		</button_text_sm>
	</template>

	<template name="button_npc_type">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="npc_button_type" />
			<script>
				function onButtonPress()
					local w = Interface.findWindow("reference_groupedlist", "reference.npc");
					if w then
						Interface.toggleWindow("reference_groupedlist", "reference.npc");
					else
						w = Interface.openWindow("reference_groupedlist", "reference.npc");
						w.init({ sRecordType = "npc", sListView = "bytype" });
					end
				end
			</script>
		</button_text_sm>
	</template>

	<template name="button_npc_trap">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="npc_button_trap" />
			<script>
				function onButtonPress()
					local w = Interface.findWindow("reference_groupedlist", "reference.npc");
					if w then
						Interface.toggleWindow("reference_groupedlist", "reference.npc");
					else
						w = Interface.openWindow("reference_groupedlist", "reference.npc");
						w.init({ sRecordType = "npc", sListView = "trap" });
					end
				end
			</script>
		</button_text_sm>
	</template>

	<template name="button_spell_class">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="spell_button_class" />
			<script>
				function onButtonPress()
				
					local w = Interface.findWindow("reference_groupedlist", "reference.spell");
					if w then
						Interface.toggleWindow("reference_groupedlist", "reference.spell");
					else
						w = Interface.openWindow("reference_groupedlist", "reference.spell");
						w.init({ sRecordType = "spell", sListView = "byclass" });
					end
				end
			</script>
		</button_text_sm>
	</template>

	<template name="button_spell_school">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="spell_button_school" />
			<script>
				function onButtonPress()
				
					local w = Interface.findWindow("reference_groupedlist", "reference.spell");
					if w then
						Interface.toggleWindow("reference_groupedlist", "reference.spell");
					else
						w = Interface.openWindow("reference_groupedlist", "reference.spell");
						w.init({ sRecordType = "spell", sListView = "byschool" });
					end
				end
			</script>
		</button_text_sm>
	</template>	

	<template name="button_spell_level">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="spell_button_level" />
			<script>
				function onButtonPress()
					local w = Interface.findWindow("reference_groupedlist", "reference.spell");
					if w then
						Interface.toggleWindow("reference_groupedlist", "reference.spell");
					else
						w = Interface.openWindow("reference_groupedlist", "reference.spell");
						w.init({ sRecordType = "spell", sListView = "bylevel" });
					end
				end
			</script>
		</button_text_sm>
	</template>

	<template name="button_starshipitem_shields">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="starshipitem_button_shields" />
			<script>
				function onButtonPress()
					local w = Interface.findWindow("reference_groupedlist", "reference.starshipshield");
					if w then
						Interface.toggleWindow("reference_groupedlist", "reference.starshipshield");
					else
						w = Interface.openWindow("reference_groupedlist", "reference.starshipshield");
						w.init({ sRecordType = "starshipitem", sListView = "starshipshield" });
					end
				end
			</script>
		</button_text_sm>
	</template>

	<template name="button_starshipitem_weapons">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="starshipitem_button_weapons" />
			<script>
				function onButtonPress()
					local w = Interface.findWindow("reference_groupedlist", "reference.starshipweapon");
					if w then
						Interface.toggleWindow("reference_groupedlist", "reference.starshipweapon");
					else
						w = Interface.openWindow("reference_groupedlist", "reference.starshipweapon");
						w.init({ sRecordType = "starshipitem", sListView = "starshipweapon" });
					end
				end
			</script>
		</button_text_sm>
	</template>
	
	<template name="button_race_letter">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="race_button_letter" />
			<script>
				function onButtonPress()
				
					local w = Interface.findWindow("reference_groupedlist", "reference.race");					
					if w then
						Interface.toggleWindow("reference_groupedlist", "reference.race");
					else
						w = Interface.openWindow("reference_groupedlist", "reference.race");
						w.init({ sRecordType = "race", sListView = "byletter" });
					end
				end
			</script>
		</button_text_sm>
	</template>

	<template name="button_companion_letter">
		<button_text_sm>
			<anchored to="buttonanchor" width="100">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="race_button_companion" />
			<script>
				function onButtonPress()
				
					local w = Interface.findWindow("reference_groupedlist", "reference.race");
					if w then
						Interface.toggleWindow("reference_groupedlist", "reference.race");
					else
						w = Interface.openWindow("reference_groupedlist", "reference.race");
						w.init({ sRecordType = "race", sListView = "bycompanion" });
					end
				end
			</script>
		</button_text_sm>
	</template>

	<template name="button_companion_holder">
		<button_text_sm>
			<anchored to="buttonanchor" width="100">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="race_button_comp_list" />
			<script>
				function onButtonPress()
				
					local w = Interface.findWindow("reference_groupedlist", "reference.companionsheet");
					if w then
						Interface.toggleWindow("reference_groupedlist", "reference.companionsheet");
					else
						w = Interface.openWindow("reference_groupedlist", "reference.companionsheet");
						w.init({ sRecordType = "race", sListView = "byowner" });
					end
				end
			</script>
		</button_text_sm>
	</template>

	<template name="button_race_type">
		<button_text_sm>
			<anchored to="buttonanchor" width="80">
				<top />
				<left anchor="right" relation="relative" offset="5" />
			</anchored>
			<state textres="race_button_type" />
			<script>
				function onButtonPress()
					local w = Interface.findWindow("reference_groupedlist", "reference.race");
					if w then
						Interface.toggleWindow("reference_groupedlist", "reference.race");
					else
						w = Interface.openWindow("reference_groupedlist", "reference.race");
						w.init({ sRecordType = "race", sListView = "bytype" });
					end
				end
			</script>
		</button_text_sm>
	</template>

	<template name="label_recordtype">
		<stringcontrol>
			<anchored to="name" position="belowleft" offset="-30,10">
				<right parent="" offset="-25" />
			</anchored>
			<font>reference-subtitle</font>
			<readonly />
		</stringcontrol>
	</template>

	<template name="frame_record_editor">
		<genericcontrol name="contentframe">
			<anchored>
				<top parent="title" anchor="bottom" offset="15" />
				<left offset="35" />
				<right offset="-35" />
				<bottom offset="-32" />
			</anchored>
			<frame name="groupbox" offset="20,17,20,17" />
			<disabled />
		</genericcontrol>
	</template>

	<template name="frame_record_lower">
		<genericcontrol>
			<anchored>
				<top anchor="bottom" offset="-50" />
				<left offset="15" />
				<right offset="-20" />
				<bottom offset="-15" />
			</anchored>
			<frame name="groupbox" />
			<disabled />
		</genericcontrol>
	</template>

	<template name="frame_record_lower_companion">
		<genericcontrol>
			<anchored>
				<top anchor="bottom" offset="-55" />
				<left offset="120" />
				<right offset="-120" />
				<bottom offset="-15" />
			</anchored>
			<frame name="groupbox" />
			<disabled />
		</genericcontrol>
	</template>

	<template name="radio_record_npctype">
		<buttongroup_radio>
			<anchored to="controlframe" height="20">
				<top offset="8" />
				<left anchor="center" offset="-75" />
			</anchored>
			<parameters>
				<optionwidth>100</optionwidth>
				<labelsres>npc_label_typecreature|npc_label_typetrap</labelsres>
				<values>Creature|Trap</values>
			</parameters>
			<script>
				function onValueChanged()
					window.TypeChanged();
				end
			</script>
		</buttongroup_radio>
	</template>
	
	<template name="radio_record_racetype">
		<buttongroup_radio>
			<anchored to="controlframe" height="20">
				<top offset="8" />
				<left anchor="center" offset="-75" />
			</anchored>
			<parameters>				
				<optionwidth>100</optionwidth>
				<labelsres>race_label_typepc|race_label_typecomp</labelsres>
				<values>PC|Companion</values>
			</parameters>
			<script>
				function onValueChanged()
					window.TypeChanged();
				end
			</script>
		</buttongroup_radio>
	</template>

	<template name="number_npc_init">
		<number_column>
			<displaysign />
			<script>
				function action(draginfo)
					local rActor = ActorManager.getActor("npc", window.getDatabaseNode());
					ActionInit.performRoll(draginfo, rActor);

					return true;
				end
				
				function onDragStart(button, x, y, draginfo)
					return action(draginfo);
				end

				function onDoubleClick(x,y)
					return action();
				end
			</script>
		</number_column>
	</template>

	<template name="number_npc_save">
		<basicnumber>
			<displaysign />
			<nodrop />
			<script>
				function action(draginfo)
					local rActor = ActorManager.getActor("npc", window.getDatabaseNode());
					ActionSave.performRoll(draginfo, rActor, self.target[1]);
					
					return true;
				end
				
				function onDragStart(button, x, y, draginfo)
					return action(draginfo);
				end
					
				function onDoubleClick(x, y)
					return action();
				end
			</script>
		</basicnumber>
	</template>

	<template name="number_npc_ability">
		<basicnumber>
			<default>10</default>
			<hideonvalue>0</hideonvalue>
			<nodrop />
			<script>
				function onInit()
					update();
				end
				
				function action(draginfo)
                    local nodeActor = window.getDatabaseNode();
                    local bCompanion = ActorManager2.isCompanion(nodeActor);
                    local rActor = nil;

                    if bCompanion then
                        rActor = ActorManager2.getActor("pc", nodeActor);
                    else
                        rActor = ActorManager.getActor("npc", nodeActor);
                    end
					ActionAbility.performRoll(draginfo, rActor, self.target[1]);
					
					return true;
				end
				
				function update()
					if (window[self.target[1]] == nil) then
						setVisible(false);
					end
				end
				
				function onDragStart(button, x, y, draginfo)
					return action(draginfo);
				end
					
				function onDoubleClick(x, y)
					return action();
				end
				
				function onValueChanged()
				local nAbility = getValue();
								
				local nMod = math.floor((getValue() - 10) / 2);
					if (window[self.modtarget[1]] ~= nil) then					   
						nMod = nMod	
					end
					if nAbility == 0 then
						
						 nMod = 0;
					end
					window[self.modtarget[1]].setValue(nMod);				
				end
			</script>
		</basicnumber>
	</template>

	<template name="number_npc_abilitymod">
		<basicnumber>
			<nodrop />
			<anchored position="belowright" offset="0,-7" height="20"/>
			<frame name="abilityscore" offset="5,-1,5,-1" />
			<font>sheetlabel</font>
			<static />
			<displaysign />
			<readonly />
			<script>
				function onInit()
					update();
				end
				
				function action(draginfo)
					local rActor = ActorManager.getActor("npc", window.getDatabaseNode());
					ActionAbility.performRoll(draginfo, rActor, self.target[1]);
					
					return true;
				end
				
				function update()				
					if (window[self.target[1]] == nil) then
						setVisible(false);
					end					
				end				
				function onDragStart(button, x, y, draginfo)
					return action(draginfo);
				end
					
				function onDoubleClick(x, y)
					return action();
				end
			</script>
		</basicnumber>
	</template>
	
	<template name="cycler_ability">
		<button_stringcycler>
			<frame mergerule="replace" name="fielddark" offset="7,5,7,5" />
			<stateframe mergerule="replace">
				<hover name="fieldfocus" offset="7,5,7,5" />
			</stateframe>
			<parameters>
				<defaultlabelres mergerule="replace">base</defaultlabelres>
				<labelsres mergerule="replace">str|dex|con|int|wis|cha</labelsres>
				<values mergerule="replace">strength|dexterity|constitution|intelligence|wisdom|charisma</values>
			</parameters>
		</button_stringcycler>
	</template>

	<template name="button_toggledetail">
		<buttoncontrol>
			<anchored width="20" height="20" />
			<state icon="button_details" />
			<state icon="button_details_down" />
			<script>
				function onValueChanged()
					if window.toggleDetail then
						window.toggleDetail();
					end
				end
			</script>
		</buttoncontrol>
	</template>

	<template name="button_enc_refreshcr">
		<buttoncontrol>
			<anchored width="23" height="23">
				<bottom parent="cr" offset="2" />
				<left parent="cr" anchor="right" offset="5"/>
			</anchored>
			<icon normal="button_charstarship_reset" pressed="button_charstarship_reset_down" />
			<tooltip textres="enc_tooltip_refreshcr" />
			<script>
				function onButtonPress()
					CombatManager2.calcBattleCR(window.getDatabaseNode());
				end
			</script>
		</buttoncontrol>
	</template>

	<template name="button_enc_refreshxp">
		<buttoncontrol>
			<anchored width="23" height="23">
				<bottom parent="exp" offset="2" />
				<left parent="exp" anchor="right" offset="5" />
			</anchored>
			<icon normal="button_charstarship_reset" pressed="button_charstarship_reset_down" />
			<tooltip textres="enc_tooltip_refreshxp" />
			<script>
				function onButtonPress()
					CombatManager2.calcBattleXP(window.getDatabaseNode());
				end
			</script>
		</buttoncontrol>
	</template>

	<template name="list_editor">
		<windowlist name="list">
			<anchored>
				<top parent="columnanchor" anchor="bottom" relation="relative" offset="22" />
				<left />
				<right />
			</anchored>
			<allowdelete />
			<child></child>
			<child><backcolor>1A40301E</backcolor></child>
			<noscroll />
			<script>
				function onInit()
					registerMenuItem(Interface.getString("list_menu_createitem"), "insert", 5);
				end
				
				function onMenuSelection(selection)
					if selection == 5 then
						self.addEntry(true);
					end
				end
				
				function onListChanged()
					update();
				end

				function update()
					local bEditMode = (window.list_iedit.getValue() == 1);
					for _,w in pairs(getWindows()) do
						w.idelete.setVisibility(bEditMode);
					end
				end
				
				function addEntry(bFocus)
					return createWindow();
				end
			</script>
		</windowlist>
	</template>

	<template name="button_charselect_companions">
		<buttoncontrol>
			<anchored to="help_charselect" height="24" width="24">
				<top />
				<right anchor="left" relation="relative" offset="-10" />
			</anchored>
			<icon normal="button_companion" pressed="button_companion_down" hover="button_companion_hover" />			
			<tooltip textres="button_companion" />
			<script>
				function onButtonPress()
					Interface.openWindow("masterindex", "companionsheet");
				end
			</script>
		</buttoncontrol>
	</template>

	<template name="button_idelete" mergerule="replace">
		<buttoncontrol>
			<anchored width="20" height="20" />
			<state icon="button_delete" tooltipres="button_delete" />
			<state icon="button_deleteconfirm" tooltipres="button_deleteconfirm" />
			<tooltip textres="button_delete" />
			<invisible />
			<script>
				function setVisibility(bVisible)
					setValue(0);
					setVisible(bVisible);
				end
				
				function onButtonPress()
					if getValue() == 0 then
						if window.delete then
							window.delete();
						else
							window.getDatabaseNode().delete();
						end
					end
				end
			</script>
		</buttoncontrol>
	</template>	
</root>
