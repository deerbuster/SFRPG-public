<?xml version="1.0" encoding="iso-8859-1"?>

<!-- 
  Please see the license.html file included with this distribution for 
  attribution and copyright information.
-->

<root>
	<windowclass name="npc">
		<frame>recordsheet</frame>
		<placement>
			<size width="450" height="550" />
		</placement>
		<sizelimits>
			<minimum width="450" height="550" />
			<dynamic />
		</sizelimits>
		<minimize>minimized_npc</minimize>
		<tooltip field="name" />
		<nodelete />
		<script file="campaign/scripts/npc.lua" />
		<sheetdata>
			<hs name="spelldisplaymode">
				<default>action</default>
			</hs>
			
			<sub_record_header name="header">
				<class>npc_header</class>
			</sub_record_header>

			<frame_record_content_tabbed name="contentframe">
				<anchored>
					<bottom offset="-65" />
				</anchored>
			</frame_record_content_tabbed>

			<subwindow_record name="main_creature">
				<class>npc_combat_creature</class>
			</subwindow_record>
			<subwindow_record name="main_trap">
				<class>npc_combat_trap</class>
			</subwindow_record>
			<subwindow_record name="spells">
				<class>npc_spells</class>
			</subwindow_record>
			<ft_record name="text">
				<anchored to="contentframe" position="over" />
				<invisible />
			</ft_record>

			<scrollbar_record>
				<target>main_creature</target>
			</scrollbar_record>
			<scrollbar_record>
				<target>main_trap</target>
			</scrollbar_record>
			<scrollbar_record>
				<target>spells</target>
			</scrollbar_record>
			<scrollbar_record>
				<target>text</target>
			</scrollbar_record>

			<tabs_recordsheet>
				<tab>
					<icon>tab_main</icon>
					<subwindow>main_creature</subwindow>
				</tab>
				<tab>
					<icon>tab_spells</icon>
					<subwindow>spells</subwindow>
				</tab>
				<tab>
					<icon>tab_other</icon>
					<subwindow>text</subwindow>
				</tab>
			</tabs_recordsheet>
			
			<frame_record_lower name="controlframe" />
			<radio_record_npctype name="npctype" />

			<resize_charsheet />
			<close_charsheet />
		</sheetdata>
	</windowclass>
	
	<windowclass name="npc_header">
		<margins control="0,0,0,7" />
		<script>
			function onInit()
				update();
				updateSummary();
			end
	
			function update()
				local bReadOnly = WindowManager.getReadOnlyState(getDatabaseNode());
				name.setReadOnly(bReadOnly);
				token.setReadOnly(bReadOnly);
				recordtype.setVisible(bReadOnly);
			end
			
			function updateSummary()
				local node = getDatabaseNode();
				
				local sNPCType = DB.getValue(node, "npctype", "");
				local sSummary = DB.getValue(node, "type", "");
				if sNPCType == "Trap" then
					if sSummary == "" then
						sSummary = "Trap";
					end
				else
					if sSummary == "" then
						sSummary = "Creature";
					end
					local sSize = DB.getValue(node, "size", "");
					if sSize ~= "" then
						sSummary = sSize .. " " .. sSummary;
					end
					local sSubtype = DB.getValue(node, "subtype", "");
					if sSubtype ~= "" then
						sSummary = sSummary .. " (" .. sSubtype .. ")";
					end
				end

				recordtype.setValue(sSummary);
			end
			function updateIDState()
				if User.isHost() then return; end
				local bID = LibraryData.getIDState("npc", getDatabaseNode());
				name.setVisible(bID);
				nonid_name.setVisible(not bID);
			end
			
		</script>
		<sheetdata>
			<link_record_header>
				<class>npc</class>
			</link_record_header>
			
			<anchor_record_header_right name="rightanchor" />
			<button_activateid>
				<anchored to="rightanchor" width="23" height="22">
					<top offset="-2" />
					<right anchor="left" relation="relative" offset="-5" />
				</anchored>
			</button_activateid>
			<tokenfield name="token">
				<anchored to="rightanchor" width="25" height="25">
					<top offset="-2" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-3" />
				</anchored>
				<empty>token_empty</empty>
				<script>
					function onDoubleClick(x, y)
						CombatManager.openMap(window.getDatabaseNode());
					end
				</script>
			</tokenfield>
			<button_record_isidentified name="isidentified" />
			<icon_record_locked>
				<anchored>
					<right offset="-7" />
				</anchored>
			</icon_record_locked>
			<button_record_locked>
				<anchored>
					<right offset="-7" />
				</anchored>
			</button_record_locked>

			<string_record_name name="name">
				<empty textres="library_recordtype_empty_npc" />
			</string_record_name>
			<string_record_name_id name="nonid_name">
				<empty textres="library_recordtype_empty_nonid_npc" />
				<invisible />
			</string_record_name_id>
			<label_recordtype name="recordtype" />
		</sheetdata>
	</windowclass>	

	<!-- NOTE: Multi-column field layouts should not use auto-hiding control templates; they won't work well. You'll need to roll your own auto-hiding code, if needed. -->
	<windowclass name="npc_combat_creature">
		<margins control="0,0,0,2" />
		<script file="campaign/scripts/npc_main.lua" />
		<sheetdata>
			<anchor_column name="columnanchor" />
			<label_column name="nonid_name_label">
				<static textres="npc_label_unidentified" />
			</label_column>
			<string_columnh name="nonid_name" />

			<line_column name="divider" />
			<label_column name="size_label">
				<static textres="npc_label_size" />
			</label_column>
			<string_columnh name="size" >
				<delaykeyupdate />
				<script>
					function onValueChanged()
						window.parentcontrol.window.header.subwindow.updateSummary();
					end
				</script>
			</string_columnh>
			<label_column name="type_label">
				<static textres="npc_label_type" />
			</label_column>
			<string_columnh name="type" >
				<delaykeyupdate />
				<script>
					function onValueChanged()
						window.parentcontrol.window.header.subwindow.updateSummary();
					end
				</script>
			</string_columnh>
			<label_column name="subtype_label">
				<static textres="npc_label_subtype" />
			</label_column>
			<string_columnh name="subtype" >
				<delaykeyupdate />
				<script>
					function onValueChanged()
						window.parentcontrol.window.header.subwindow.updateSummary();
					end
				</script>
			</string_columnh>			
			<label_column name="race_label">
				<static textres="npc_label_race" />
			</label_column>
			<string_columnh name="race" />
			<label_column name="grafts_label">
				<static textres="npc_label_grafts" />
			</label_column>
			<string_columnh name="grafts" />			
			<label_column name="alignment_label">
				<static textres="npc_label_alignment" />
			</label_column>
			<string_column name="alignment" >
				<anchored>
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="7" />
					<left parent="" anchcor="left" offset="97" />
					<right parent="" anchor="right" offset="-120" />
				</anchored>
			</string_column>
			
			<number_column_right name="cr">
				<anchored to="alignment" width="70" />
			</number_column_right>
			<label name="cr_label">
				<anchored to="cr" >
					<top />
					<right parent="cr" anchor="left" offset="-10"/>
				</anchored>
				<static textres="npc_label_cr" />
			</label>	
			<label_column name="init_label">
				<static textres="initiative" />
			</label_column>
			<number_npc_init name="init" />
			<number_column_right name="xp">
				<anchored to="init" width="70"  />
			</number_column_right>
			<label name="xp_label">
				<anchored to="xp" >
					<top />
					<right parent="xp" anchor="left" offset="-10"/>
				</anchored>
				<static textres="npc_label_xp" />
			</label>
			<label_column name="senses_label">
				<static textres="npc_label_senses" />
			</label_column>
			<string_columnh name="senses">
				<senses_only />
				<script file="campaign/scripts/npc_skill.lua" />
			</string_columnh>
			<label_column name="aura_label">
				<static textres="npc_label_aura" />
			</label_column>
			<string_columnh name="aura" />

			<header_column name="defense_header">
				<static textres="npc_header_defense" />
			</header_column>
			
			<label_column name="ac_label">
				<anchored>
					<top offset="20" />
				</anchored>
				<static textres="npc_label_ac" />
			</label_column>
			<number_column name="eac">
				<anchored width="40" height="20">
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="20" />
					<left offset="97" />
				</anchored>
			</number_column>
			<label_fieldtop name="eac_label">
				<anchored to="eac" />
				<static textres="npc_label_eac" />
			</label_fieldtop>			
			<basicnumber name="kac">
				<anchored to="eac" width="40" height="20">
					<top />
					<left anchor="right" relation="relative" offset="10" />
				</anchored>
			</basicnumber>
			<label_fieldtop name="kac_label">
				<anchored to="kac" />
				<static textres="npc_label_kac" />
			</label_fieldtop>			
			<label_column name="health_label">
				<anchored>
					<top offset="20" />
				</anchored>
				<static textres="npc_label_health" />
			</label_column>
			<number_column name="hp" >
				<anchored width="40" height="20">
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="20" />
					<left offset="97" />
				</anchored>
			</number_column>
			<label_fieldtop name="hp_label">
				<anchored to="hp" />
				<static textres="npc_label_hp" />
			</label_fieldtop>
			<basicnumber name="rp">
				<anchored to="hp" width="40" height="20">
					<top />
					<left anchor="right" relation="relative" offset="10" />
				</anchored>
			</basicnumber>
			<label_fieldtop name="rp_label">
				<anchored to="rp" />
				<static textres="npc_label_rp" />
			</label_fieldtop>			
			<label_column>
				<anchored>
					<top offset="20" />
				</anchored>
				<static textres="npc_label_saves" />
			</label_column>
			<number_npc_save name="fortitudesave">
				<anchored width="40" height="20">
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="20" />
					<left offset="97" />
				</anchored>
				<target>fortitude</target>
			</number_npc_save>
			<label_fieldtop name="fortitudesave_label">
				<anchored to="fortitudesave" />
				<static textres="fortitude" />
			</label_fieldtop>
			<number_npc_save name="reflexsave">
				<anchored to="fortitudesave" width="40" height="20">
					<top />
					<left anchor="right" relation="relative" offset="10" />
				</anchored>
				<target>reflex</target>
			</number_npc_save>
			<label_fieldtop name="reflexsave_label">
				<anchored to="reflexsave" />
				<static textres="reflex" />
			</label_fieldtop>
			<number_npc_save name="willsave">
				<anchored to="fortitudesave" width="40" height="20">
					<top />
					<left anchor="right" relation="relative" offset="10" />
				</anchored>
				<target>will</target>
			</number_npc_save>
			<label_fieldtop name="willsave_label">
				<anchored to="willsave" />
				<static textres="will_long" />
			</label_fieldtop>
			<label_column name="defensiveabilities_label">
				<static textres="npc_label_dabilities" />
			</label_column>
			<string_columnh name="defensiveabilities" />
			<label_column name="weaknesses_label">
				<static textres="npc_label_weaknesses" />
			</label_column>
			<string_columnh name="weaknesses" />
			
			<header_column name="offense_header">
				<static textres="npc_header_offense" />
			</header_column>
			
			<label_column name="speed_label">
				<static textres="npc_label_speed" />
			</label_column>
			<string_columnh name="speed" />
			<label_column name="melee_label">
				<static textres="npc_label_melee" />
			</label_column>
			<string_columnh name="melee">
				<actortype>npc</actortype>
				<actorpath>..</actorpath>
				<script file="common/scripts/string_attackline.lua" />
			</string_columnh>
			<label_column name="multiatk_label">
				<static textres="npc_label_multiatk" />
			</label_column>
			<string_columnh name="multiatk">
				<actortype>npc</actortype>
				<actorpath>..</actorpath>
				<script file="common/scripts/string_attackline.lua" />
			</string_columnh>
			<label_column name="ranged_label">
				<static textres="npc_label_rangedatk" />
			</label_column>
			<string_columnh name="ranged">
				<actortype>npc</actortype>
				<actorpath>..</actorpath>
				<ranged />
				<script file="common/scripts/string_attackline.lua" />
			</string_columnh>	
			<label_column name="space_label">
				<static textres="npc_label_space" />
			</label_column>
			<number_columnh name="space" />
			<label_column name="reach_label">
				<static textres="npc_label_reach" />
			</label_column>
			<number_columnh name="reach" />
			<label_column name="spacereachnote_label">
				<static textres="npc_label_spacereachnote" />
			</label_column>
			<string_columnh name="spacereachnote" />
			<label_column name="offensiveabilities_label">
				<static textres="npc_label_offabilities" />
			</label_column>
			<string_columnh name="offensiveabilities" >
				<actortype>npc</actortype>
				<actorpath>..</actorpath>
				<script file="common/scripts/string_attackline.lua" />
			</string_columnh>
			<label_column name="spelllikeabilities_label">
				<static textres="npc_label_sabilities" />
			</label_column>
			<string_columnh name="spelllikeabilities" />

			<header_column name="stats_header">
				<static textres="npc_header_stats" />
			</header_column>
			
			<label_column name="abilities_label">
				<anchored>
					<top offset="20" />
				</anchored>
				<static textres="npc_label_abilities" />
			</label_column>
			<number_npc_ability name="strength" source="abilities.strength.score">
				<anchored width="25" height="20">
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="20" />
					<left offset="97" />
				</anchored>
				<target>strength</target>
				<modtarget>strength_modifier</modtarget>
			</number_npc_ability>
			<label_fieldtop name="strength_label">
				<anchored to="strength" />
				<static textres="str" />
			</label_fieldtop>
			<number_npc_abilitymod name="strength_modifier" source="abilities.strength.bonus">
				<anchored to="strength" />
				<target>strength</target>
			</number_npc_abilitymod>	
			
			<number_npc_ability name="dexterity" source="abilities.dexterity.score">
				<anchored to="strength" width="25" height="20">
					<top />
					<left anchor="right" relation="relative" offset="10" />
				</anchored>
				<target>dexterity</target>
				<modtarget>dexterity_modifier</modtarget>
			</number_npc_ability>
			<label_fieldtop name="dexterity_label">
				<anchored to="dexterity" />
				<static textres="dex" />
			</label_fieldtop>
			<number_npc_abilitymod name="dexterity_modifier" source="abilities.dexterity.bonus">
				<anchored to="dexterity" />
				<target>dexterity</target>
			</number_npc_abilitymod>			
			
			<number_npc_ability name="constitution" source="abilities.constitution.score">
				<anchored to="strength" width="25" height="20">
					<top />
					<left anchor="right" relation="relative" offset="10" />
				</anchored>
				<target>constitution</target>
				<modtarget>constitution_modifier</modtarget>
			</number_npc_ability>
			<label_fieldtop name="constitution_label">
				<anchored to="constitution" />
				<static textres="con" />
			</label_fieldtop>
			<number_npc_abilitymod name="constitution_modifier" source="abilities.constitution.bonus">
				<anchored to="constitution" />
				<target>constitution</target>
			</number_npc_abilitymod>			
			
			<number_npc_ability name="intelligence" source="abilities.intelligence.score">
				<anchored to="strength" width="25" height="20">
					<top />
					<left anchor="right" relation="relative" offset="10" />
				</anchored>
				<target>intelligence</target>
				<modtarget>intelligence_modifier</modtarget>
			</number_npc_ability>
			<label_fieldtop name="intelligence_label">
				<anchored to="intelligence" />
				<static textres="int" />
			</label_fieldtop>
			<number_npc_abilitymod name="intelligence_modifier" source="abilities.intelligence.bonus">
				<anchored to="intelligence" />
				<target>intelligence</target>
			</number_npc_abilitymod>			
			
			<number_npc_ability name="wisdom" source="abilities.wisdom.score" >
				<anchored to="strength" width="25" height="20">
					<top />
					<left anchor="right" relation="relative" offset="10" />
				</anchored>
				<target>wisdom</target>
				<modtarget>wisdom_modifier</modtarget>
			</number_npc_ability>
			<label_fieldtop name="wisdom_label">
				<anchored to="wisdom" />
				<static textres="wis" />
			</label_fieldtop>
			<number_npc_abilitymod name="wisdom_modifier" source="abilities.wisdom.bonus">
				<anchored to="wisdom" />
				<target>wisdom</target>
			</number_npc_abilitymod>			
			
			<number_npc_ability name="charisma" source="abilities.charisma.score" >
				<anchored to="strength" width="25" height="20">
					<top />
					<left anchor="right" relation="relative" offset="10" />
				</anchored>
				<target>charisma</target>
				<modtarget>charisma_modifier</modtarget>
			</number_npc_ability>
			<label_fieldtop name="charisma_label">
				<anchored to="charisma" />
				<static textres="cha" />
			</label_fieldtop>
			<number_npc_abilitymod name="charisma_modifier" source="abilities.charisma.bonus">
				<anchored to="charisma" />
				<target>charisma</target>
			</number_npc_abilitymod>		
			<header_column name="statistics_header">
				<anchored>
				<top offset = "20" />
				</anchored>
				<static textres="npc_header_statistics" />
			</header_column>
			<label_column name="skills_label">
				<static textres="npc_label_skills" />
			</label_column>
			<string_columnh name="skills">
				<script file="campaign/scripts/npc_skill.lua" />
			</string_columnh>
			<label_column name="feats_label">
				<static textres="npc_label_feats" />
			</label_column>
			<string_columnh name="feats" />			
			<label_column name="languages_label">
				<static textres="npc_label_languages" />
			</label_column>
			<string_columnh name="languages" />
			<label_column name="otherabilities_label">
				<static textres="npc_label_oabilities" />
			</label_column>
			<string_columnh name="otherabilities" />

			<header_column name="ecology_header">
				<static textres="npc_header_ecology" />
			</header_column>
			
			<label_column name="environment_label">
				<static textres="npc_label_environment" />
			</label_column>
			<string_columnh name="environment" />
			<label_column name="organization_label">
				<static textres="npc_label_organization" />
			</label_column>
			<string_columnh name="organization" />

			<header_column name="specialabilities_header">
				<static textres="npc_header_sabilities" />
			</header_column>
			
			<button_iedit name="specialabilities_iedit">
				<anchored to="specialabilities_header" position="righthigh" offset="-20,0" />
				<target>specialabilities</target>
			</button_iedit>
			<button_iadd name="specialabilities_iadd">
				<anchored to="specialabilities_iedit" position="lefthigh" offset="5,0" />
				<target>specialabilities</target>
			</button_iadd>
			<list_column name="specialabilities">
				<datasource>.specialabilities</datasource>
				<sortby><control>name</control></sortby>
				<class>npc_specialabilitylistentry</class>
			</list_column>
		</sheetdata>
	</windowclass>
	<windowclass name="npc_specialabilitylistentry">
		<margins control="0,0,0,2" />
		<script>
			function update(bReadOnly)
				name.setReadOnly(bReadOnly);
			end
		</script>
		<sheetdata>
			<anchor_listitem_column_right name="rightanchor" />
			<link_listitem_column name="shortcut">
				<class>npc_specialability</class>
			</link_listitem_column>
			<button_listitem_column_delete name="idelete" />

			<string_listitem_column_name name="name">
				<anchored offset="5,2" />
				<empty textres="library_recordtype_empty_classfeature" />
			</string_listitem_column_name>
		</sheetdata>
	</windowclass>
	<windowclass name="npc_specialability">
		<frame>recordsheet_small</frame>
		<placement>
			<size width="250" height="250" />
		</placement>
		<sharable />
		<sizelimits>
			<minimum width="350" height="350" />
			<dynamic />
		</sizelimits>
		<minimize>minimized_reference</minimize>
		<tooltip field="name" />
		<nodelete />
		<playercontrol />
		<sharable />
		<script>
			function onLockChanged()
				if header.subwindow then
					header.subwindow.update();
				end
				if main.subwindow then
					main.subwindow.update();
				end
			end
		</script>
		<sheetdata>
			<sub_record_header name="header">
				<class>npc_specialability_header</class>
			</sub_record_header>

			<frame_record_content_tabbed name="contentframe" />

			<subwindow_record name="main">
				<activate />
				<class>npc_specialability_main</class>
			</subwindow_record>
			<scrollbar_record>
				<target>main</target>
			</scrollbar_record>
						
			<resize_recordsheet />
			<close_recordsheet />
		</sheetdata>
	</windowclass>	
	<windowclass name="npc_specialability_main">
		<margins control="0,0,0,7" />
		<script>
			function onInit()
				update();
			end
			function update()
				local bReadOnly = WindowManager.getReadOnlyState(getDatabaseNode());
				text.setReadOnly(bReadOnly);
			end
		</script>
		<sheetdata>
			<anchor_column name="columnanchor" />			
			<string_column_full name="text" />			
		</sheetdata>
	</windowclass>
	<windowclass name="npc_specialability_header">
		<margins control="0,0,0,2" />
		<script>
			function onInit()
				update();
			end
			function update()
				local bReadOnly = WindowManager.getReadOnlyState(getDatabaseNode());
				name.setReadOnly(bReadOnly);
			end
		</script>
		<sheetdata>
			<link_record_header name="shortcut">
				<class>npc_specialability</class>
			</link_record_header>

			<anchor_record_header_right />
			<icon_record_locked />
			<button_record_locked />

			<string_record_name name="name">
				<empty textres="library_recordtype_empty_npc_specialability" />
			</string_record_name>
			<label_recordtype name="recordtype">
				<static textres="record_label_npc_specialability" />
			</label_recordtype>	
		</sheetdata>
	</windowclass>
	<windowclass name="npc_spells">
		<margins control="0,0,0,2" />
		<script file="campaign/scripts/npc_spells.lua" />
		<sheetdata>
			<button_expand name="expand_full">
				<anchored position="insidetopleft" offset="5,2" width="20" height="20" />
				<target>spellclasslist,levels,spells</target>
				<togglelevel>2</togglelevel>
				<invisible />
			</button_expand>
			<button_collapse name="collapse_full">
				<anchored position="insidetopleft" offset="35,2" width="20" height="20" />
				<target>spellclasslist,levels,spells</target>
				<togglelevel>2</togglelevel>
				<invisible />
			</button_collapse>
			<button_expand name="expand_mini">
				<anchored position="insidetopleft" offset="5,2" width="20" height="20" />
				<target>spellclasslist_mini,levels,spells</target>
				<togglelevel>2</togglelevel>
				<invisible />
			</button_expand>
			<button_collapse name="collapse_mini">
				<anchored position="insidetopleft" offset="35,2" width="20" height="20" />
				<target>spellclasslist_mini,levels,spells</target>
				<togglelevel>2</togglelevel>
				<invisible />
			</button_collapse>
			<label name="label_mode">
				<anchored position="insidetopleft" offset="75,2" height="20" />
				<static textres="spell_label_mode" />
				<invisible />
			</label>
			<button_stringcycler name="spellmode">
				<anchored to="label_mode" position="righthigh" offset="10,0" width="80" />
				<parameters>
					<labelsres>spell_label_modeprep|spell_label_modecombat</labelsres>
					<values>preparation|combat</values>
					<defaultlabelres>spell_label_modestd</defaultlabelres>
				</parameters>
				<invisible />
				<script>
					function onValueChanged()
						window.onModeChanged();
					end
				</script>
			</button_stringcycler>
			<buttoncontrol name="spellclasslist_iadd">
				<anchored position="insidetopright" offset="35,2" width="20" height="20" />
				<icon normal="button_star" pressed="button_star_down" />
				<tooltip textres="npc_tooltip_spelladdclass" />
				<invisible />
				<script>
					function onButtonPress()
						window.addSpellClass();
					end
				</script>
			</buttoncontrol>
			<button_iedit name="spellclasslist_iedit">
				<anchored position="insidetopright" offset="5,2" width="20" height="20" />
				<tooltip textres="npc_tooltip_spelledit" />
				<target>spellclasslist</target>
				<invisible />
				<script>
					function onValueChanged()
						local bEditMode = (getValue() == 1);
						
						window.label_mode.setVisible(not bEditMode);
						window.spellmode.setVisible(not bEditMode);
						if bEditMode then
							DB.setValue(window.getDatabaseNode(), "spellmode", "string", "standard");
						end
						window.spellclasslist_iadd.setVisible(bEditMode);
						window.spellclasslist.update();
					end
				</script>
			</button_iedit>

			<list_spellclass name="spellclasslist">
				<anchored position="insidetop" offset="0,30" />
				<class>spell_class</class>
				<npc />
				<invisible />
				<script>
					function onInit()
						super.onInit();
						registerMenuItem(Interface.getString("menu_addspellclass"), "insert", 5);
						registerMenuItem(Interface.getString("menu_resetspells"), "lockvisibilityon", 8);
					end
					
					function onMenuSelection(selection)
						if selection == 5 then
							window.addSpellClass();
						elseif selection == 8 then
							SpellManager.resetSpells(window.getDatabaseNode());
						end
					end
				</script>
			</list_spellclass>
			<list_spellclass name="spellclasslist_mini">
				<anchored position="insidetop" offset="0,30" />
				<class>spell_class_mini</class>
				<npc />
				<minisheet />
				<readonly />
				<invisible />
				<script>
					function onInit()
						super.onInit();
						registerMenuItem(Interface.getString("menu_resetspells"), "lockvisibilityon", 8);
					end
					
					function onMenuSelection(selection)
						if selection == 8 then
							SpellManager.resetSpells(window.getDatabaseNode());
						end
					end
				</script>
			</list_spellclass>
		</sheetdata>
	</windowclass>
	
	<windowclass name="npc_combat_trap">
		<margins control="0,0,0,2" />
		<script file="campaign/scripts/npc_main.lua" />
		<sheetdata>
			<anchor_column name="columnanchor" />
			
			<label_column name="xp_label">
				<static textres="npc_label_xp" />
			</label_column>
			<number_column name="xp" />

			<label_column_right name="cr_label">
				<anchored to="xp" />
				<static textres="npc_label_cr" />
			</label_column_right>
			<number_column_right name="cr">
				<anchored to="xp" />
			</number_column_right>

			<label_column name="hp_label">
				<static textres="npc_label_hp" />
			</label_column>
			<number_columnh name="hp" />			
			
			<label_column name="type_label">
				<static textres="npc_label_type" />
			</label_column>
			<string_columnh name="type" />
			
			<header_column>
				<static textres="npc_header_statistics" />
			</header_column>
			
			<label_column name="perception_label">
				<static textres="npc_label_perception" />
			</label_column>
			<string_columnh name="perception" />
			
			<label_column name="disable_label">
				<static textres="npc_label_disable" />
			</label_column>
			<string_columnh name="disable" />

			<label_column name="init_label">
				<static textres="npc_label_init" />
			</label_column>
			<number_columnh name="init" >
				<displaysign />
			</number_columnh>
			
			<label_column name="eac_label">
				<static textres="npc_label_eac" />
			</label_column>
			<number_column name="eac" />
			
			<label_column_right name="kac_label">
				<anchored to="eac" />
				<static textres="npc_label_kac" />
			</label_column_right>
			<number_column_right name="kac">
				<anchored to="eac" />
			</number_column_right>

			<label_column name="goodsave_label">
				<static textres="npc_label_goodsave" />
			</label_column>
			<number_column name="goodsave">
				<displaysign />
			</number_column>
			<label_column_right name="poorsave_label">
				<anchored to="goodsave" />
				<static textres="npc_label_poorsave" />
			</label_column_right>
			<number_column_right name="poorsave">
				<anchored to="goodsave" />
				<displaysign />
			</number_column_right>

			<label_column name="space_label">
				<static textres="npc_label_space" />
			</label_column>
			<number_column name="space">
				<default>0</default>
			</number_column>
			<label_column name="reach_label">
				<static textres="npc_label_reach" />
			</label_column>
			<number_column name="reach">
				<default>0</default>
			</number_column>

			<label_column name="attack_label">
				<static textres="npc_label_attack" />
			</label_column>
			<number_column name="attack">
				<displaysign />
			</number_column>
			<label_column_right name="savedc_label">
				<anchored to="attack" />
				<static textres="npc_label_savedc" />
			</label_column_right>
			<number_column_right name="savedc">
				<anchored to="attack" />
			</number_column_right>
			
			<label_column name="damage_label">
				<static textres="npc_label_damage" />
			</label_column>
			<string_columnh name="damage">
			<actortype>npc</actortype>
				<actorpath>..</actorpath>
				<ranged />
				<script file="common/scripts/string_attackline.lua" />
			</string_columnh>
			
			<label_column name="trigger_label">
				<static textres="npc_label_trigger" />
			</label_column>
			<string_columnh name="trigger" />
			
			<label_column name="duration_label">
				<static textres="npc_label_duration" />
			</label_column>
			<string_columnh name="duration" />
			
			<label_column name="reset_label">
				<static textres="npc_label_reset" />
			</label_column>
			<string_columnh name="reset" />
			
			<label_column name="bypass_label">
				<static textres="npc_label_bypass" />
			</label_column>
			<string_columnh name="bypass" />
			
			<label_column name="effect_label">
				<static textres="npc_label_effect" />
			</label_column>
			<string_columnh name="effect">
			<actortype>npc</actortype>
				<actorpath>..</actorpath>
				<ranged />
				<script file="common/scripts/string_attackline.lua" />
			</string_columnh>
			
			<label_column name="initialeffect_label">
				<static textres="npc_label_initialeffect" />
			</label_column>
			<string_columnh name="initialeffect" />

			<label_column name="secondaryeffect_label">
				<static textres="npc_label_secondaryeffect"/>
			</label_column>
			<string_columnh name="secondaryeffect" />
			
		</sheetdata>
	</windowclass>
</root>